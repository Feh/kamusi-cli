<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de" lang="de">
<head>
    <title>Poor Man's Kamusi</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script type="text/javascript" src="/js/jquery.min.js">
    </script>
    <style type="text/css">
        input {
            border:         1px solid #c0c0c0;
        }

        p#form {
            padding-bottom: .7em;
            border-bottom:  1px solid #c0c0c0;
        }

        a:link, a:visited, a:hover, a:active {
            font-family:    Verdana, sans-serif;
            font-size:      .8em;
            text-decoration: none;
        }
    </style>
</head>

<body>

<form>
    <p id="form">
    <input type="text" name="q" id="q" value="" />
    <a href="#" id="d">sw -> en</a>
    <a href="#" id="s">squeeze?</a>
    </p>
</form>

<p id="result">
</p>

<script type="text/javascript">
    // http://stackoverflow.com/questions/1909441/jquery-keyup-delay
    var delay = (function() {
            var timer = 0;
            return function(callback, ms) {
                clearTimeout (timer);
                timer = setTimeout(callback, ms);
            };
        })();

    $("#q").keyup(
        function() {
            delay(function() { update_results(0); }, 250);
        }
    );

    function update_results(force) {
        if($("#q").val().length >= 2 && (force || $("#q").val() != $("#q").data('old'))) {
            $("#q").data('old', $("#q").val()); // save previous value (cursor->noop)
            $("#result").fadeOut(200);
            $.get("/kamusi.cgi", {
                    'q': $("#q").val(),
                    's': $("#s").data('value'),
                    'd': $("#d").data('value')
                },
                function(data) {
                    // $("#result").fadeOut(200);
                    // $("#result").hide()
                    $("#result").html(data);
                    $("#result").fadeIn(200)
                }
            );
        }
    }

    $("#s").click(function() {
        $(this).data('value', !$(this).data('value'));
        $(this).text('squeeze' + ($(this).data('value')?'!':'?'));
        update_results(1);
    });

    $("#d").click(function() {
        if($("#d").data('value') == 'sw') {
            $("#d").data('value', 'en');
            $(this).text('en->sw');
        } else {
            $(this).data('value', 'sw');
            $(this).text('sw->en');
        }
        update_results(1);
    });

    $("form").submit(function() { update_results(1); return false; });
    $("#q").focus();
    $("#s").data('value', false);
    $("#d").data('value', 'sw');
</script>

</body>
</html>
